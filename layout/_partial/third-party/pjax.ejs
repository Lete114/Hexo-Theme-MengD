<%if(theme.pjax){%>
    <script src="<%-theme.CDN.pjax%>"></script>
    <script>
        var pjax = new Pjax({
            selectors: [
                "head title",
                "main.content",
                <%-theme.toc.enable==true?'"#toc"':""%>
            ],
            cache: true,
            cacheBust: false
        });

        // 开始 PJAX 执行的函数
		document.addEventListener('pjax:send', function () {
            // 执行进度条
            ProgressStart()
        });
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
		document.addEventListener('pjax:complete', function () {

            // 加载进度条加载完毕
            ProgressFinish()
            // 手机端
            Mobile()
            // 代码块复制
            CopyContent()
            // Fancybox
            FancyboxFn()
            
            // 深色模式
            if(localStorage.isDark=="dark"){
                $("body").addClass("dark")
                $("#darkmode i").attr("class","fas fa-sun")
            }else{
                $("body").removeClass("dark")
                $("#darkmode i").attr("class","fas fa-moon")
            }

            $('#darkmode').click(function () {
                if($('#darkmode i').attr("class")=="fas fa-moon"){
                    localStorage.isDark = "dark";
                    $("body").css("transition","all .3s linear")
                    $("body").addClass("dark")
                    $("#darkmode i").attr("class","fas fa-sun")
                }else{
                    localStorage.isDark = "";
                    $("body").css("transition","all .3s linear")
                    $("body").removeClass("dark")
                    $("#darkmode i").attr("class","fas fa-moon")
                }
            })
            
            document.querySelectorAll('script[data-pjax]').forEach(item => {
                const newScript = document.createElement('script')
                const content = item.text || item.textContent || item.innerHTML || ""
                Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
                newScript.appendChild(document.createTextNode(content))
                item.parentNode.replaceChild(newScript, item)
            })
        });

        // Pjax请求错误时，跳转到404页面
        document.addEventListener('pjax:error', (e) => {
            if (e.request.status === 404) {
                pjax.loadUrl('/404.html')
            }
        })
    </script>
    <%}%>